<!DOCTYPE html>
<html>
<head>
  <title>Clock In</title>
  <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
</head>
<body>
  <h1>Clock In System</h1>

  <!-- Camera scanner -->
  <div id="reader" style="width:300px; height:300px;"></div>
  <p id="result">Scan your card...</p>

  <!-- File upload option -->
  <h3>Or upload a QR code image:</h3>
  <input type="file" id="qr-input-file" accept="image/*">

  <script>
    // Replace with your Google Apps Script URL
    const sheetURL = "https://script.google.com/macros/s/AKfycbzkBXpN4T40BQdw0idbWpN8GAWcF9QLAR6km-PJmuGcyw6OwQ_W8e1H8ZHjrxdpUAYP0g/exec";
    const sheetURL = "https://script.google.com/macros/s/AKfycbwps9KCEVhUMSFt9BqvNkYgMhUAwmahXSgwMelTQa5etWFqlRUlLC0NiL2BK_JaFacmcg/exec";

    function sendToSheet(data) {
        fetch("https://script.google.com/macros/s/AKfycbzkBXpN4T40BQdw0idbWpN8GAWcF9QLAR6km-PJmuGcyw6OwQ_W8e1H8ZHjrxdpUAYP0g/exec", {
        fetch("https://script.google.com/macros/s/AKfycbwps9KCEVhUMSFt9BqvNkYgMhUAwmahXSgwMelTQa5etWFqlRUlLC0NiL2BK_JaFacmcg/exec", {
            method: "POST",
            mode: "no-cors",   // 👈 prevents CORS errors
            headers: {
                "Content-Type": "application/json"
            },
        body: JSON.stringify({ id: data })
    })
    .then(() => {
        console.log("✅ Sent to Google Sheet:", data);
        // you won’t get a response back in no-cors mode
    })
    .catch(err => {
        console.error("❌ Error sending to Google Sheet:", err);
        });
    }


    function onScanSuccess(decodedText) {
      let people = {
        "12345": "Coltin",
        "67890": "Cassy"
      };

      let name = people[decodedText] || "Unknown";
      sendToSheet(name, decodedText);
    }

    // --- Camera Scanner ---
    const html5QrCode = new Html5Qrcode("reader");

    Html5Qrcode.getCameras().then(cameras => {
      if (cameras && cameras.length > 0) {
        const cameraId = cameras[0].id;
        html5QrCode.start(
          { deviceId: { exact: cameraId } },
          { fps: 10, qrbox: 250 },
          (decodedText) => { onScanSuccess(decodedText); },
          (errorMessage) => {}
        );
      }
    }).catch(err => {
      console.error("Camera error:", err);
    });

    // --- File Upload Scanner ---
    document.getElementById("qr-input-file").addEventListener("change", e => {
      if (e.target.files.length == 0) return;

      const file = e.target.files[0];
      if (!file) return;

      html5QrCode.scanFile(file, true)
        .then(decodedText => {
          onScanSuccess(decodedText);
        })
        .catch(err => {
          document.getElementById("result").innerText = "Could not read QR from image.";
          console.error("File scan error:", err);
        });
    });
  </script>
</body>
</html>
